# Others
在网上有看到一些很多关于网络库性能的讨论，所以我想在此讨论一下项目中的取舍和改进   
## 1. 缓存
muduo中的缓存直接采用了vector<char>的方式，利用stl库本身进行缓存管理。作者也提出了这种方式欠佳可以修改为链式缓存或手动管理的块式缓存。两种方式我都有进行尝试但在使用链式缓存时我发现性能没有提升，但对使用上却造成了一些麻烦。因此最终采用了块式缓存+缓存池的方式。
## 2. 定时器
netlib中的定时器使用了linux内核提供的timerfd进行定时器触发。网上对timerfd的使用有着一些批评，主要为timerfd的性能问题。但目前我没有看到一个比较确定的性能分析，且在corvus这样的工业级软件上也使用了timerfd这种方式来触发定时器，所以我认为timerfd本身还是有一定的使用性。在测试中timerfd的精度也比较好，基本在微妙级误差。但直接使用std::set进行定时器管理可能是个问题，后续也许会改为最小堆的方式。
## 3. 多态
还有一些涉及对中多态的使用，即针对poller采用了多态的方式分别实现select、poll和epoll。我认为这不算是一个问题但还是改为了宏编译的方式实现的poller。
## 4. 短连接
主线程作为Acceptor的方式可能会在涉及大量短连接时产生主线程繁忙的问题，为此我做了两个改进：
1. 在一次poller中尽可能多的accept客户端请求，即使用while(true) { accept(...) }的方式
2. 将对连接的初始化放置于IO线程中，主线程仅负责选择IO线程并分发任务